: config dir cc-path
Inc=${Inc-/usr/include}
Configure=${1-configure}
shift
CC=${*-cc}
echo "
#ifndef _sh_config_
#define	_sh_config_	1
/*
 * This has been generated from $Configure/config
 * The information is based on the compile time environment.
 * It may be necessary to change values of some parameters for cross
 *  development environments.
 */

#include	<sys/types.h>
"
CPP="$CC -E"
status=2
trap "rm -f dummy.* a.out core; exit \$status" 0 1 2
rm -f /tmp/junk$$
echo "#include \"/tmp/junk$$\"" > dummy.c
: see whether cc -E gives error for bad includes
if	$CPP dummy.c > /dev/null 2>&1
then	if	 test -r /lib/cpp
	then CPP=/lib/cpp
	elif	test -r /usr/lib/cpp
	then CPP=/usr/lib/cpp
	else	CPP=true
	fi
	if	$CPP dummy.c > /dev/null 2>&1
	then	echo "could not autoconfigure cc -E gives wrong exit status" >&2
		exit 2
	fi
fi
rm -f /tmp/junk$$
LIB= ENV=
: make sure all the files are here
for i in OPTIONS
do	if	test ! -r $Configure/$i
	then	echo "$Configure/$i: file missing or not readable" >&2
		exit 1
	fi
done
for i in bcopy data fastfork ftime getgroups getppid getrlimit int16 ispipe \
	hz lstat nfile opendir rand select setjmp sigrelse\
	sigrestart sigvec setreuid strchr sibuf wait3 vlimit void yellowp \
	lock socket poll memset nice
do	if	test ! -r $Configure/$i.c
	then	echo "$Configure/$i.c: file missing or not readable" >&2
		exit 1
	fi
done
for i in acct bsdtty dirent execargs fcntl file filio ioctl \
	locale mnttab nttyio sgtty \
	times termio termios wait unistd universe utsname vfork
do	echo "#include <$i.h>" > dummy.c
	if	$CPP dummy.c > /dev/null 2>&1
	then	echo "#define _${i}_ 1"
	fi
	echo "#include <sys/$i.h>" > dummy.c
	if	$CPP dummy.c > /dev/null 2>&1
	then	echo "#define _sys_${i}_	1"
	fi
done
: Note, should use -x, but not all tests have it
if	test -d /usr/ucb
then	echo "#define _usr_ucb_	1"
fi
if	test -f /bin/grep
then	echo "#define _bin_grep_	1"
fi
if	test -f /usr/bin/lpr
then	echo "#define _usr_bin_lpr_	1"
fi
if	test -f /usr/bin/lp
then	echo "#define _usr_bin_lp_	1"
fi
if	test -f /usr/bin/vi
then	echo "#define _usr_bin_vi_	1"
fi
if	test -f /bin/newgrp
then	echo "#define _bin_newgrp_	1"
fi
echo "#include <sys/resource.h>" > dummy.c
if	$CPP dummy.c > /dev/null 2>&1
then	SYS_RESOURCE=1
fi
echo "#include <sys/vlimit.h>" > dummy.c
if	$CPP dummy.c > /dev/null 2>&1
then	SYS_VLIMIT=1
fi
if	test  "$SYS_RESOURCE" || test  "$SYS_VLIMIT"
then	if	test  "$SYS_RESOURCE" && 
			$CC $Configure/getrlimit.c $LIB > /dev/null 2>&1  &&
			./a.out 2> /dev/null
	then	echo "#define _sys_resource_	1"
	elif	$CC $Configure/vlimit.c $LIB > /dev/null 2>&1
	then	./a.out 2> /dev/null
	fi
	rm -f a.out
fi
: some systems have termios but it does not work
{ $CC -DTERMIOS $Configure/ioctl.c $LIB > /dev/null 2>&1 && ./a.out 2> /dev/null;}||
	{
		echo "#undef _termios_"
		echo "#undef _sys_termios_"
	}
rm -f a.out
: some systems have termio but it does not work
echo "#include <termio.h>" > dummy.c
if	$CPP dummy.c > /dev/null 2>&1
then	_TERMIO=1
fi
echo "#include <sys/ioctl.h>" > dummy.c
if	$CPP dummy.c > /dev/null 2>&1
then	SYS_IOCTL=1
fi
if	test  "$_TERMIO" && test  "$SYS_IOCTL"
then	if	$CC $Configure/ioctl.c $LIB > /dev/null 2>&1
	then	./a.out 2> /dev/null
	fi
	rm -f a.out
fi
: check for the poll system call
if	$CC $Configure/poll.c > /dev/null 2>&1
then	./a.out 2> /dev/null
	rm -f a.out
fi
: compile and run a program that uses const
if	$CC $Configure/data.c $LIB > /dev/null 2>&1 && sh -c './a.out 1' 2> /dev/null
then	sh -c ./a.out > /dev/null 2>&1 && echo "#define const /* empty */"
else	echo "#define const /* empty */"
fi
rm -f a.out
VOID=int
echo "#include <signal.h>" > dummy.c
if	$CPP dummy.c > dummy.out 2>&1 && grep -c void dummy.out >/dev/null 2>&1
then	echo "#define VOID	void"
	VOID=void
else	echo "#define VOID	int"
fi	
if	$CC $Configure/ftime.c $LIB > /dev/null 2>&1
then	./a.out 2> /dev/null
fi
rm -f a.out
DIRLIB=
if	test -r /usr/lib/dir.a
then	DIRLIB=/usr/lib/dir.a
elif	test -r /usr/lib/libdir.a
then	DIRLIB=/usr/lib/libdir.a
elif	test -r /usr/lib/ndir.a
then	DIRLIB=/usr/lib/ndir.a
elif	test -r /usr/lib/libndir.a
then	DIRLIB=/usr/lib/libndir.a
fi
: make sure that there is an a.out file before running $Configure/opendir.c
> a.out
for i in dirent ndir
do	if	$CC -D_${i}_ $Configure/opendir.c $LIB > /dev/null 2>&1 && 
		  ./a.out 2> /dev/null
	then	break
	elif	test "$DIRLIB" &&
		  $CC -D_${i}_ $Configure/opendir.c $DIRLIB $LIB > /dev/null 2>&1 && 
		  ./a.out 2> /dev/null
	then	echo "		/* requires
		  $DIRLIB
		*/"
		break
	else	echo "#undef _${i}_"
	fi
	rm -f a.out
done
cat > dummy.c <<!
#include <sys/file.h>
#ifdef LOCK_EX
"$$LOCK_EX$$"
#else
#   ifdef O_CREAT
	"$$O_CREAT$$"
#   endif
#endif
!
if	$CC -E dummy.c > dummy.out 2>&1
then	if	grep -c "$$LOCK_EX$$" dummy.out > /dev/null 2>&1  ||
		grep -c "$$O_CREAT$$" dummy.out > /dev/null 2>&1 
	then	:
	else	echo "#undef _sys_file_"
	fi
fi
if	test -r /lib/libjobs.a
then	LIB="/lib/libjobs.a $LIB"
elif	test -r /usr/lib/libjobs.a
then	LIB="/usr/lib/libjobs.a $LIB"
fi
if	$CC -Dsignal=sigset -DVOID=$VOID $Configure/sigrestart.c $LIB > /dev/null 2>&1 &&
		./a.out 2> /dev/null
then	echo "#define signal	sigset"
	echo "extern VOID (*sigset())();"
	sigdef=sigset
elif	$CC -DVOID=$VOID $Configure/sigrestart.c $LIB > /dev/null 2>&1 &&
		./a.out 2> /dev/null
then	:
else	echo "/*** Warning SIG_NORESTART may have to be set ***/"
	echo "*** Warning SIG_NORESTART may have to be set ***" >&2
	warn=1
fi
rm -f a.out
if      $CC $Configure/sigvec.c $LIB > /dev/null 2>&1  && ./a.out 2> /dev/null
then	echo "#define _lib_sigvec	1"
fi
rm -f a.out
if      $CC -Dsigrelse=' ' ${sigdef+-Dsignal=sigset} $Configure/sigrelse.c $LIB > /dev/null 2>&1  && ./a.out 2> /dev/null
then	:
elif        $CC -DSIGBLOCK ${sigdef+-Dsignal=sigset} $Configure/sigrelse.c $LIB > /dev/null 2>&1 && ./a.out 2> /dev/null
then    :
elif      $CC ${sigdef+-Dsignal=sigset} $Configure/sigrelse.c $LIB > /dev/null 2>&1  && ./a.out 2> /dev/null
then	:
else	echo "#define sigrelease(s)"
	echo "#define sig_begin()"
fi
rm -f a.out
if	$CC -Dwaitpid $Configure/wait3.c $LIB > /dev/null 2>&1 && ./a.out 2> /dev/null
then	:
elif	$CC $Configure/wait3.c $LIB > /dev/null 2>&1 && ./a.out 2> /dev/null
then	echo "#define waitpid(a,b,c)	wait3((union wait*)b,c,0)"
else	echo "#define waitpid(a,b,c)	wait(b)"
	echo "#define WAIT1ARG	1"
fi
rm -f a.out
if	$CC $Configure/nfile.c $LIB > /dev/null 2>&1
then	./a.out 2> /dev/null
fi
rm -f a.out
if	$CC $Configure/int16.c $LIB > /dev/null 2>&1
then	./a.out
else	echo "/*** Warning INT16 may have to be set ***/"
	echo "*** Warning INT16 may have to be set ***" >&2
	warn=1
fi
rm -f a.out
if	$CC $Configure/rand.c $LIB > /dev/null 2>&1
then	./a.out
else	echo "/*** Warning need to redefine random number function ***/"
	echo "*** Warning need to redefine random number function ***" >&2
	echo "#define sh_rand()"
	warn=1
fi
rm -f a.out
if	$CC $Configure/ispipe.c $LIB > /dev/null 2>&1
then	./a.out
else	echo "/*** Warning PIPE_ERR not set ***/"
	echo "*** Warning PIPE_ERR not set ***" >&2
	warn=1
fi
rm -f a.out
if	$CC $Configure/void.c $LIB > /dev/null 2>&1 && ./a.out 2> /dev/null
then 	if	$CC $Configure/proto.c $LIB > /dev/null 2>&1 && ./a.out 2> /dev/null
	then	echo "#define PROTO	1"
	fi
else	echo "#define void	int"
fi
rm -f a.out
if	$CC $Configure/setjmp.c $LIB > /dev/null 2>&1
then	./a.out 2> /dev/null
else	echo "#define SETJMP	setjmp"
	echo "#define LONGJMP	longjmp"
fi
rm -f a.out
: check for sockets
if	$CC $Configure/socket.c $LIB > /dev/null 2>&1
then	./a.out 2> /dev/null
elif	$CC $Configure/socket.c $LIB -lsocket -lnsl > /dev/null 2>&1
then	./a.out 2> /dev/null
	LIB="$LIB -lsocket -lnsl"
	echo '/*
	-lsocket -lnsl
	*/'
fi
rm -f a.out
: check for yellow pages service
if	$CC $Configure/yellowp.c $LIB > /dev/null 2>&1
then	./a.out 2> /dev/null
elif	$CC $Configure/yellowp.c $LIB -lsun > /dev/null 2>&1
then	./a.out 2> /dev/null
	echo '/*
	-lsun
	*/'
fi
rm -f a.out
if	$CC $Configure/getgroups.c $LIB > /dev/null 2>&1 && ./a.out 2> /dev/null
then	if	$CC -D_parm_ $Configure/getgroups.c $LIB > /dev/null 2>&1 ||
		$CC -D_sysparm_ $Configure/getgroups.c $LIB > /dev/null 2>&1
	then	./a.out 2> /dev/null || echo "#define MULTIGROUPS	16"
	else	echo "#define MULTIGROUPS	16"
	fi
fi
if	$Configure/shellmagic > /dev/null
then	echo "#define SHELLMAGIC	1"
fi
echo "#include <fcntl.h>" > dummy.c
if	$CC -E dummy.c > /dev/null 2>&1
then	d=-D_fcntl_
else	d=
fi
rm -f a.out
if	$CC $d $Configure/fcntl.c $LIB > /dev/null 2>&1
then	./a.out 2> /dev/null
else	echo "#define NOFCNTL	1"
fi
rm -f a.out
$CC  $Configure/hz.c $LIB > /dev/null 2>&1 && ./a.out
if	$CC $Configure/lock.c $LIB > /dev/null 2>&1 && ./a.out a.out 2> /dev/null
then	echo "#define _FLOCK	1"
fi
rm -f a.out
$CC $Configure/sibuf.c $LIB > /dev/null 2>&1 && ./a.out 2> /dev/null ||
{
	if	$CC -D_sibuf=__sibuf $Configure/sibuf.c $LIB > /dev/null 2>&1 && ./a.out 2> /dev/null
	then	echo "#define _sibuf	__sibuf"
		echo "#define _sobuf	__sobuf"
	else	echo "#define NOBUF	1"
	fi
}
rm -f a.out
if	$CC $Configure/setreuid.c $LIB > /dev/null 2>&1 && ./a.out 2> /dev/null
then	echo "#define SETREUID	1"
fi
rm -f a.out
if	$CC $Configure/getppid.c $LIB > /dev/null 2>&1 && ./a.out 2> /dev/null
then	: 'The function getppid() is in the library'
else	echo "#define getppid()	1"
fi
rm -f a.out
if	$CC $Configure/nice.c $LIB > /dev/null 2>&1 && ./a.out 2> /dev/null
then	: 'The function nice() is in the library'
else	echo "#define nice(x)	(1)"
fi
rm -f a.out
if	$CC $Configure/lstat.c $LIB > /dev/null 2>&1 && ./a.out 2> /dev/null
then	echo "#define LSTAT	1"
fi
rm -f a.out
if	$CC $Configure/syscall.c $LIB > /dev/null 2>&1
then	(./a.out||exit 1) 2> /dev/null
fi
rm -f a.out
if	$CC $Configure/strchr.c $LIB > /dev/null 2>&1 && ./a.out 2>/dev/null
then	:
else	if	$CC -Dstrchr=index $Configure/strchr.c $LIB > /dev/null 2>&1 && 
		./a.out 2>/dev/null
	then	echo "#define strchr	index"
		echo "#define strrchr	rindex"
	else	echo "/*** Warning strchr and strrchr may have to be set ***/"
		echo "*** Warning strchr and strrchr may have to be set ***" >&2
	fi
fi
rm -f a.out
if	$CC $Configure/memset.c $LIB > /dev/null 2>&1 && ./a.out 2>/dev/null
then	:
else	if	$CC -DBZERO $Configure/strchr.c $LIB > /dev/null 2>&1 && 
		./a.out 2>/dev/null
	then	echo "#define memset(a,b,c)	bzero(a,c)"
	else	echo "#define NOMEMSET	1"
	fi
fi
rm -f a.out
: create types for uid_t, gid_t, pid_t if they do not already exist
for i in uid_t gid_t pid_t
do      echo "#include <sys/types.h>" > dummy.c
	echo "struct { ${i} foo;};" >> dummy.c
	$CC -c dummy.c > /dev/null 2>&1 || echo "typedef int ${i};"
done
: create types for time_t and off_t if they do not already exist
for i in time_t off_t
do      echo "#include <sys/types.h>" > dummy.c
	echo "struct { ${i} foo;};" >> dummy.c
	$CC -c dummy.c > /dev/null 2>&1 || echo "typedef long ${i};"
done
: create type for clock_t unless in sys/time.h or sys/types.h
_SYSTIME=
echo "#include <sys/time.h>" > dummy.c
if	$CC -E dummy.c > /dev/null 2>&1
then	_SYSTIME=1
	echo "struct { clock_t foo;};" >> dummy.c
	if	$CC -c dummy.c > /dev/null 2>&1
	then	echo "#include 	<sys/time.h>"
		echo "#define included_sys_time_"
	else	echo "#include <sys/types.h>" > dummy.c
		echo "struct { clock_t foo;};" >> dummy.c
		$CC -c dummy.c > /dev/null 2>&1 || {
		echo "#ifndef _CLOCK_T"
		echo "#define _CLOCK_T"
		echo "typedef long clock_t;"
		echo "#endif"
	}
		echo "#define _sys_Time_"
	fi
else	echo "#include <sys/types.h>" > dummy.c
	echo "struct { clock_t foo;};" >> dummy.c
	$CC -c dummy.c > /dev/null 2>&1 || {
		echo "#ifndef _CLOCK_T"
		echo "#define _CLOCK_T"
		echo "typedef long clock_t;"
		echo "#endif"
	}
fi
if	test -d /dev/fd
then	echo "#define DEVFD	1"
fi
: Check for VPIX
if	test -f /usr/bin/vpix
then	echo "#define VPIX	1"
fi
: Check for file needed for RDS
if	test -r /etc/mnttab
then	echo "#define MNTTAB	\"/etc/mnttab\""
fi
: Check behavior of /bin/echo
if	test -f /bin/echo
then	if	test X"`/bin/echo -n`" = X
	then	echo "#define ECHO_N	1"
	fi
	if	test X"`/bin/echo '\c'`" = X'\c'
	then	echo "#define ECHO_RAW	1"
	else	if	test X"`/bin/echo -`" = X
		then	echo "#define ECHOPRINT	1"
		fi
	fi
fi
if	test -f /bin/universe && /bin/universe > /dev/null 2>&1
then    echo "#define UNIVERSE  1"
	univ=`/bin/universe`
	if	test "$SYS_IOCTL" && test ucb = "$univ"
	then	echo "#undef _termio_"
		echo "#undef _sys_termio_"
	fi
fi
rm -f a.out
if	$CC -DMEMCPY $Configure/bcopy.c $LIB > /dev/null 2>&1 && ./a.out 2> /dev/null
then	: 'The function memcpy is in the library'
else	echo "#define NOMEMCPY	1"
	$CC $Configure/bcopy.c $LIB > /dev/null 2>&1 && ./a.out 2> /dev/null ||
		echo "#define NOBCOPY	1"
fi
rm -f a.out
if	$CC $Configure/fastfork.c $LIB > /dev/null 2>&1 && ./a.out 2> /dev/null
then	echo "#define VFORK	1"
fi
rm -f a.out
: See whether signal.h contains SIGCLD or SIGCHLD
cat > dummy.c <<!
#include <signal.h>
#ifdef SIGCLD
"$$SIGCHLD$$"
#endif
#ifdef SIGCHLD
"$$SIGCHLD$$"
#endif
!
if	$CC -E dummy.c > dummy.out 2>&1 && 
		grep -c "$$SIGCHLD$$" dummy.out > /dev/null 2>&1
then	echo "#define JOBS	1"
fi
: see whether there is an ioctl to find the window size
for i in -DTERMIOS -DTERMIO -DSGTTY
do	if	${CC} $i $Configure/winsize.c $LIB> /dev/null 2>&1 && ./a.out 2> /dev/null
	then	break
	elif	${CC} $i -DPTEM $Configure/winsize.c $LIB> /dev/null 2>&1 && ./a.out 2> /dev/null
	then	break
	elif	${CC} $i -DSTREAM $Configure/winsize.c $LIB> /dev/null 2>&1 && ./a.out 2> /dev/null
	then	break
	elif	${CC} $i -DSTREAM -DPTEM $Configure/winsize.c $LIB> /dev/null 2>&1 && ./a.out 2> /dev/null
	then	break
	elif	${CC} $i -DJIOCTL $Configure/winsize.c $LIB> /dev/null 2>&1 && ./a.out 2> /dev/null
	then	break
	fi
	rm -f a.out
done
if	test -f /usr/lib/dic/euc.dic
then	echo "#define MULTIBYTE	1"
fi
: enable FS_3D by default on systems with dynamic loading
if	( ldd /bin/date) > /dev/null 2>&1 && ldd /bin/date | grep libc > /dev/null
then	echo "#define FS_3D	1"
elif	test -r /lib/libc.sl
then	echo "#define FS_3D	1"
fi
if	test "$_SYSTIME" && $CC $Configure/select.c > /dev/null 2>&1
then	./a.out 2> /dev/null
elif	test "$_SYSTIME" && $CC -S4 $Configure/select.c > /dev/null 2>&1
then	./a.out 2> /dev/null
fi
rm -f a.out
if	test -d /NextAdmin
then	echo "#define NeXT	1"
fi
echo
. $Configure/OPTIONS
for i in ACCT BRACEPAT ECHOPRINT ESH ESHPLUS FLOAT FS_3D IODELAY JOBS \
	MULTIBYTE NEWTEST OLDTERMIO OLDTEST P_UID PDU POSIX RDS RAWONLY \
	SEVENBIT SUID_EXEC TIMEOUT VSH LDYNAMIC
do	: This could be done with eval, but eval broken in some shells
	j=0
	case $i in
	ACCT)		j=$ACCT;;
	BRACEPAT)	j=$BRACEPAT;;
	ECHOPRINT)	j=$ECHOPRINT;;
	ESH)		j=$ESH;;
	ESHPLUS)	j=$ESHPLUS;;
	FLOAT)		j=$FLOAT;;
	FS_3D)		j=$FS_3D;;
	IODELAY)	j=$IODELAY;;
	JOBS)		j=$JOBS;;
	LDYNAMIC)	j=$LDYNAMIC;;
	MULTIBYTE)	j=$MULTIBYTE;;
	NEWTEST)	j=$NEWTEST;;
	OLDTERMIO)	echo "#include <sys/termios.h>" > dummy.c
			echo "#include <sys/termio.h>" >> dummy.c
			if	$CC -E dummy.c > /dev/null 2>&1
			then	j=$OLDTERMIO
			fi ;;
	OLDTEST)	j=$OLDTEST;;
	P_UID)		j=$P_UID;;
	PDU)		j=$PDU
			if	test 0 -ne "$j" && test -f /usr/pdu/bin/pwd
			then	echo "#define PDUBIN	1"
			fi;;
	POSIX)		j=$POSIX;;
	RAWONLY)	j=$RAWONLY;;
	RDS)		j=$RDS;;
	SEVENBIT)	j=$SEVENBIT;;
	SUID_EXEC)	j=$SUID_EXEC;;
	TIMEOUT)	j=$TIMEOUT;;
	VSH)		j=$VSH;;
	esac
	case $j in
	0|"")	;;
	*)	echo "#define $i	$j" ;;
	esac
done
echo '#endif'
status=0
